name: Build Windows Executable

on:
  push:
    branches: [ kivymd-ui-update-direct ]
  pull_request:
    branches: [ kivymd-ui-update-direct ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install nuitka
        pip install kivymd
        pip install kivy
        pip install pillow
        pip install requests
        pip install qrcode
        pip install bcrypt
        pip install cryptography
        pip install pygame
        pip install plyer
        
    - name: Build Windows executable
      run: |
        nuitka --standalone ^
        --include-package=kivymd ^
        --include-package=kivy ^
        --include-package=PIL ^
        --include-package=requests ^
        --include-package=qrcode ^
        --include-package=bcrypt ^
        --include-package=cryptography ^
        --include-package=pygame ^
        --include-package=plyer ^
        --windows-disable-console ^
        --output-filename=AceVault-Windows.exe ^
        --assume-yes-for-downloads ^
        main.py
        
    - name: Upload Windows executable
      uses: actions/upload-artifact@v4
      with:
        name: AceVault-Windows-Executable
        path: main.dist/
        retention-days: 30
        
    - name: Create release info
      run: |
        echo "Build completed successfully!" > build-info.txt
        echo "Download the AceVault-Windows-Executable artifact" >> build-info.txt
        echo "Extract and run AceVault-Windows.exe" >> build-info.txt
        
    - name: Upload build info
      uses: actions/upload-artifact@v4
      with:
        name: Build-Instructions
        path: build-info.txt